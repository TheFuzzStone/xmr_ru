---
title: "Эмпирическое влияние «Мординалов» (токенов NFT Monero) на приватность"
date: "2022-06-24"
categories:
  - "Статьи"
tags:
  - "Научно-фантастический рассказ"
lead: "Мординалы (mordinals) могут снизить уровень приватности пользователей Monero, если их выходы будут включены в обычные кольцевые подписи транзакций в качестве ложных. Незадолго до резкого роста майнинга мординалов протокол децентрализованного майнинга P2Pool был обновлён с целью повышения эффективности выплат и минимизации влияния мординалов. В нижней точке средний размер кольца уменьшился до 12,5. Номинальный размер кольца при этом равен 16."
pager: true
toc: false
sidebar: "right"
---

Мординалы разрабатывались как токены NFT Monero. Протокол помещает данные изображений, например, файлы jpeg, в поле `tx_extra` транзакций Monero.

Данный протокол использует нестандартный способ выбора ложных выходов для построения кольцевой подписи, чтобы продемонстрировать, что мординал действительно был передан. Поэтому, когда в кольцевой подписи обычной транзакции в качестве ложного выхода используется выход транзакции с мординалом, ложный выход в виде мординала не заслуживает доверия. Внешний наблюдатель будет знать, что ложный выход на самом деле является ложным, и не может быть реальным выходом траты.

В исследовательской лаборатории Monero таких участников кольца, которых можно исключить как реальные выходы траты, называются «чёрными шарами». Этот термин был взят из классического сценария, связанного с теорией вероятности, когда из урны случайным образом достаются шары разных цветов. В нашем случае я использую выражение **«эффективный размер кольца»**, чтобы обозначить размер кольца транзакции после изъятия определённого количества «чёрных шаров» из кольца номинального размера. Сегодня размер кольца Monero равен 16, поэтому _эффективный размер кольца 16 минус некоторое количество «чёрных шаров»_.

Сколько чёрных шаров находится в урне? Мординалы размещают определённую часть данных в поле `tx_extra`, чтобы идентифицировать себя как мординалы. Их можно подсчитать, просканировав блокчейн Monero.

## Выходы coinbase-транзакций, выступающие в качестве чёрных шаров

Выходы coinbase-транзакций также можно считать разновидностью чёрных шаров. В coinbase-транзакциях майнеры получают своё вознаграждение за вычисление блока. Выходы таких транзакций потенциально могут быть исключены как реальные выходы траты в обычных транзакциях. Рядовой пользователь не будет напрямую тратить выходы coinbase-транзакций из майнинг-пула при взаимодействии с продавцами (операторы пулов сначала платят майнерам, используя coinbase-транзакции). Coinbase-транзакции, полученные майнинг-пулами, можно идентифицировать, поскольку пулы, как правило, публикуют информацию о вычисленных блоках на своих веб-сайтах.

Наибольшая доля выходов coinbase-транзакций создаётся децентрализованным протоколом майнинга P2Pool. Выходы транзакций, выплачиваемых P2Pool, можно исключить как достоверные ложные выходы, поскольку они обычно расходуются в крупных транзакциях с большим количеством входов, а не в отдельных мелких «обычных» транзакциях. Каждый блок, вычисленный в P2Pool, оплачивается десяткам майнеров в отдельных выходах. sech1 и duggavo придумали, как сделать выплаты более эффективными. Обновление P2Pool состоялось 18 марта. Как оказалось, время было выбрано довольно удачно. Сразу после того, как P2Pool перестал производить большое количество «чёрных шаров», это стало происходить из-за использования мординалов.

## Объём выходов, создаваемых в рамках протокола Mordinal и в coinbase-транзакциях

Ниже показан график ежедневного процента выходов. Создаваемых в рамках протокола Moirdinal и в coinbase-транзакциях. После обновления P2Pool доля выходов в coinbase-транзакциях снизилась с примерно 18 процентов до приблизительно 9 процентов. Активность майнинга в соответствии с протоколом Mordinal возросла в конце марта. После 1 апреля такой майнинг практически прекратился без каких-либо видимых причин. Обновлённая версия узлов Monero, призванная ограничить размер поля `tx_extra`, была официально выпущена только 10 апреля.

![01](/img/copyright/articles/2023-04-13-empirical-privacy-impact-of-mordinals-monero-nfts/01.png)  

По моим подсчётам, с 10 марта по 11 апреля 2023 года было создано 43 083 мординалов. Сумма комиссий, выплаченных при проведении этих транзакций, составила 7,47 XMR. Эти транзакции добавили в блокчейн Monero 370 мегабайт данных.

## Как происходит выбор ложных выходов для кольцевых подписей Monero

Для вычисления эффективного размера кольца недостаточно просто знать количество чёрных шаров в блокчейне. Алгоритм выбора ложных выходов Monero не подразумевает выбора таких выходов за один отдельно взятый день. Каждый выход, подходящий для создания кольцевой подписи в соответствии с протоколом RingCT, даже с небольшой вероятностью может быть выбран в качестве ложного. Алгоритм выбора ложных выходов был разработан таким образом, что последние выходы будут выбраны с гораздо большей вероятностью, чем старые, поскольку пользователи с более высокой вероятностью потратят выход, который был создан в течение последних недель. На приведённом ниже графике в упрощённом виде показано, как работает алгоритм выбора ложных выходов Monero — вместо 16 показано всего 8 участников кольца.

![02](/img/copyright/articles/2023-04-13-empirical-privacy-impact-of-mordinals-monero-nfts/02.png)  
_График составлен на основе графика ACK-J_

Добавим к набору выходов чёрные шары, которые могут быть выбраны в качестве ложных:

![03](/img/copyright/articles/2023-04-13-empirical-privacy-impact-of-mordinals-monero-nfts/03.png)  
_График составлен на основе графика ACK-J_

В этом примере 2 из 8 участников кольца являются чёрными шарами. Если кто-то захочет определить реальный выход траты, может исключить эти два чёрных шара и сосредоточиться на оставшихся 6 участниках кольца. Таким образом, эффективный размер кольца в этом примере равен 6.

## Эмпирический метод определения эффективного размера кольца

Фактический размер кольца, используемый в каждой транзакции, может быть вычислен путём сканирования блокчейна Monero. То есть, используя данные блокчейна, мы можем эмпирически вычислить эффективный размер кольца. Мы можем рассмотреть ситуацию, в которой злоумышленник (1) рассматривает в качестве чёрных шаров только мординалы; (2) считает чёрными шарами только выходы coinbase-транзакций; или (3) считает чёрными шарами и мординалы, и выходы coinbase-транзакций. Так вычисляется эффективный размер каждого кольца. На графике ниже показано среднее ежедневное значение эффективного размера кольца.

![04](/img/copyright/articles/2023-04-13-empirical-privacy-impact-of-mordinals-monero-nfts/04.png)  

Средний эффективный размер кольца упал до 12,5, когда в конце марта резко возросла доля мординалов в эмиссии. Это вызывает беспокойство, но стоит забывать, что до хард-форка в августе 2022 года номинальный размер кольца составлял 11. Снижение количества выходов coinbase-транзакций после обновления P2Pool частично компенсировало рост количества выходов мординалов.

Поскольку количество майнинговых транзакций  в рамках протокола Mordinal со временем уменьшается с точки зрения выбора ложных выходов, их влияние на эффективный размер кольца ослабевает. Благодаря обновлению P2Pool совокупный эффективный размер кольца при создании coinbase-транзакций и транзакций Mordinal (фиолетовая линия) сейчас немного выше, чем был в феврале.

На графике выше показан средний эффективный размер кольца. Эффективный размер кольца некоторых колец может быть намного меньше среднего, поскольку ложные выходы выбираются случайным образом. При построении некоторых колец выбирается большее количество чёрных шаров, чем в среднем. Нам нужно отслеживать распространённость таких редких «неудачных» транзакций. Ведь мы заботимся обо всём, что происходит в Monero.

На графике ниже отслеживается ежедневный 5-й перцентиль эффективного размера кольца. Когда линия 5-го перцентиля находится на отметке 12, это означает, что 5 процентов колец имеют эффективный размер кольца, равный 12, или меньше.

![05](/img/copyright/articles/2023-04-13-empirical-privacy-impact-of-mordinals-monero-nfts/05.png)  

На графике видно, в течение двух дней в конце марта что «самые неудачные» 5% колец имели эффективный размер кольца, равный  9 или ниже.

## Возможные способы решения проблемы

Существует несколько способов снизить влияние мординалов на уровень приватности пользователей Monero. Некоторые из предлагаемых вариантов имеют существенные недостатки.

### Исключение coinbase-транзакций при выборе ложных выходов

Стандартный алгоритм выбора ложных выходов может быть изменён таким образом, чтобы при создании обычной транзакции в их качестве не выбирались выходы coinbase-транзакций. Таким образом в кольцевых подписях выходы coinbase-транзакций более не будут являться теми самыми чёрными шарами. Этот вариант более подробно описан в документе Monero Research Lab №109, написанном мной. jeffro256 создал пул-реквест №8815, в котором предлагается соответствующий вариант реализации в кодовой базе Monero. Вопрос о сроках реализации остаётся открытым. Если изменение будет внесено без хардфорка, это может навредить однородности транзакций, поскольку только часть пользователей и программного обеспечения кошельков в экосистеме Monero обновятся до изменённой версии алгоритма выбора ложных выходов.

### Исключение мординалов при выборе ложных выходов

Как и в случае с выводами coinbase-транзакций, выходы транзакций, созданных в соответствии с протоколом Mordinal, можно исключить при выборе ложных выходов. Это изменение не так просто внести, как при исключении выходов coinbase-транзакций. Что если формат мординалов изменится так, что кошелёк и код демона не смогут их обнаружить? Что если появится другой протокол NFT? Вы быстро окажетесь в «адовой» ситуации. Потенциальные проблемы, связанные с тем, что пользователи не обновят программное обеспечение своих кошельков, будут только множиться.

### Запрет на передачу мордимналов при использовании стандартного алгоритма выбора ложных выходов

Транзакции, в которых передаются мординалы, также можно рассматривать в качестве чёрных шаров. Протокол Mordinal подразумевает «передачу» мординалов путём включения кольцо только специальных «сожжённых» выходов, за исключением самого исходного выхода мординала. Это нестандартный алгоритм выбора ложных выходов. «Стандартный» алгоритм реализован в «официальном» программном обеспечении кошелька Monero, но пользователи и разработчики программного обеспечения кошелька не обязаны использовать его. Кошельки можно заставить использовать стандартный алгоритм в рамках правил ретрансляции транзакций между узлами или даже правил консенсуса. Эта идея обсуждалась в документе Monero Research Lab №87 как способ повышения единообразия транзакций.

При использовании стандартного алгоритма выбора ложных выходов мординалы более нельзя будет передавать в том виде, в каком они передаются сейчас. Мординалы будут «уничтожены», когда в кольцевую подпись будут включены правдоподобные ложные выходы. Протокол Mordinal может обойти это правило, используя криптографическое доказательство передачи вместо передачи с помощью нестандартного алгоритма выбора ложных выходов.

### Изменение правил заполнения поля tx_extra таким образом, чтобы использование мординалов стало менее привлекательным (в новейшей версии программного обеспечения).

Узлы Monero, работающие под управлением последней версии программного обеспечения 0.18.2.2, не будут пересылать неподтверждённую транзакцию с полем `tx_extra`, содержащим более 1060 байт данных. Однако такие обновлённые узлы будут принимать новые вычисленные блоки, содержащие транзакции, превышающие этот лимит. На мой взгляд, изменение правил ретрансляции транзакций без хардфорка будет эффективным только в том случае, если подавляющее большинство сетевых узлов и майнинг-пулов обновятся до той версии программного обеспечения, которая обеспечит соблюдение правил. В противном случае такие правила будут подобны дырявому решету. Мординалы с изображениями с низким разрешением, укладывающимися в лимит в 1060 байт, по-прежнему будут передаваться и подтверждаться в обычном режиме. Кроме того, даже если полностью убрать поле `tx_extra`, данные изображений можно будет вставить в те части транзакции, которые, как правило, зарезервированы для криптографической информации.

### Увеличение размера кольца

Размер кольца может быть увеличен выше значения 16, что позволит увеличить количество надёжных ложных выходов в каждом кольце. Недостатком увеличения размера кольца без изменения криптографических основ (как это будет сделано в предлагаемом обновлении Seraphis) является то, что размер транзакции также увеличится. Размер блокчейна будет расти более быстрыми темпами. Увеличение размера кольца потребует хардфорка и обновления сети.

---

_Код для воспроизведения результатов данного анализа можно найти [здесь](https://github.com/Rucknium/misc-research/tree/main/Monero-Effective-Ring-Size)._

_kayabaNerve помог мне понять, как распознать в блокчейне транзакции, созданные в соответствии с  протоколом Mordinal. Также я выражаю благодарность gingeropolous, администратору Monero Research Lab Computing Server, за представленные вычислительные ресурсы._

---

_Источник: [Empirical Privacy Impact of Mordinals (Monero NFTs)](https://www.reddit.com/r/Monero/comments/12kv5m0/empirical_privacy_impact_of_mordinals_monero_nfts/)_

_Перевод: [Mr. Pickles](https://t.me/v1docq47)_  
_Коррекция: [Kukima](https://t.me/Kukima)_
