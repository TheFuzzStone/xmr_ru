---
title: "«Числитель» - научно-фантастический рассказ в стиле Monero"
date: "2022-05-02"
categories:
  - "Статьи"
tags:
  - "Научно-фантастический рассказ"
lead: "Вы, вероятно, знаете, что сердце вашего компьютера или смартфона, то есть та его часть, где происходит вся «магия» — это процессор. Но вы когда-нибудь задумывались над тем, что на самом деле делает этот микрочип, если заглянуть «вглубь», сквозь все слои графического пользовательского интерфейса, программ и приложений, даже саму операционную систему?"
pager: true
toc: false
sidebar: "right"
---

Самый низкий уровень, представленный доступным программным обеспечением, называется машинным кодом. Это набор команд, каждая из которых делает что-то очень простое, например, складывает два числа или проверяет, больше ли одно число, чем другое. Современный CPU за секунду способен выполнить много миллионов команд, которые все вместе делают что-то полезное. Они закодированы на уровне байтов; когда типовой процессор Intel или AMD видит байт, например, со значением 64, он воспринимает его как команду увеличить число на 1.

Но не все CPU существуют в виде физических чипов, устанавливаемых в реальные устройства. Люди изобрели «виртуальные» процессоры с собственными наборами команд для решения различных задач, а затем реализовали их в виде программного обеспечения, работающего на «реальных» процессорах.

Одним из примеров, где можно увидеть, как это работает, является криптовалюта Monero. Система называется RandomX, и тот, кто хочет заработать Monero путём «майнинга», должен как можно быстрее выполнять программы в рамках соответствующего набора команд, используя виртуальный процессор RandomX в надежде, что результат выполнения программы удовлетворит некоторое условие, которое необходимо выполнить для получения вознаграждения за вычисление блока.

RandomX известно около 30 команд. Как правило, в нескольких байтовых значениях закодирована одна и та же команда; например, значение от 0 до 15 воспринимается процессором RandomX как конкретный вариант сложения. В целом каждое возможное байтовое значение в диапазоне от 0 до 255 сопоставляется с командой.

Причину, по которой, в случае с Monero, для майнинга имеет смысл использовать эту проработанную схему и даже дойти до реализации какого-то причудливого CPU, невозможно объяснить в нескольких предложениях, но фундаментальную цель сформулировать довольно просто: никто не сможет построить машины, которые будут добывать Monero в 1000 раз быстрее, и иметь таким образом несправедливое преимущество.

---

Майнеры Monero были недовольны. Несколько недель назад в рамках так называемого хардфорка была реализована новая версия программного обеспечения Monero. В наборе команд RandomX были внесены некоторые изменения, после чего начали поступать сообщения о частых случайных сбоях машин при запуске программ для майнинга. Все это выглядело довольно загадочно, потому что сбоило не само программное обеспечение, а совсем другие работающие одновременно программы, а иногда и операционная система.

Безусловно, совершенно невозможно, чтобы нормальная программа выводила операционную систему из строя, заставляя вас перезагрузить компьютер, и, как правило, такого не случалось, но с майнерами RandomX происходило нечто совсем иное. Люди, обладающие необходимым опытом отладки, после анализа проблемы пришли к выводу, что в какой-то момент в каком-то разделе основной памяти компьютера изменились какие-то случайные байты, как казалось, без какого-либо участия в этом майнингового программного обеспечения, что, очевидно, звучало абсолютно безумно. И эта загадка начала расходиться волнами даже за пределы криптовалютного мира.

Мое личное участие во всём этом началось, когда Мэтт связался со мной для приватной беседы в IRC. Он был одним из тех контрибьюторов Monero, кто занимался разработкой кода RandomX и изменил набор команд.

_**\<matt>**_ Мне очень жаль, что наше программное обеспечение крушит чужие компьютеры налево и направо. Только подумай о том, как это навредит имиджу Monero. Это нужно остановить. Может, ты сможешь помочь?  
_**\<rbrunner>**_ Но как? Я многого не знаю о RandomX, равно как и об отладке случайных сбоев компьютера.  
_**\<matt>**_ Может и так. Но ты из тех, кто «мыслит нестандартно», и, возможно, это именно то, что и нужно в этом случае. Могу я поделиться с тобой секретом?  
_**\<rbrunner>**_ Я люблю секреты :)  
_**\<matt>**_ Мы сказали всем, что мы изменили RandomX, чтобы отговорить людей от разработки специализированного быстрого оборудования для выполнения этого алгоритма. Просто ради безопасности.  
_**\<rbrunner>**_ Да, и это имеет смысл, не так ли? Сохраняется достоверный уровень угрозы финансовых потерь, потому что оборудование может устареть из-за наших изменений.  
_**\<matt>**_ Верно. Но это ложь.  
_**\<rbrunner>**_ А правда будет в том, что ты хочешь мне рассказать?  
_**\<matt>**_ Кто-то пожертвовал большую сумму в общий фонд разработки, чтобы получить новую команду, реализованную в соответствии с заданной спецификацией.  
_**\<rbrunner>**_ «Кто-то»? И ты не знаешь кто это?  
_**\<matt>**_ Нет. Это было сделано анонимно.  
_**\<rbrunner>**_ И ты не знаешь, почему, полагаю?  
_**\<matt>**_ Нет, мотивация совершенно неясна.  
_**\<rbrunner>**_ Безумие какое-то. Я тоже хочу свою собственную приватную команду RandomX! И никто не усмотрел в этом никакого подвоха?  
_**\<matt>**_ С чего бы? RandomX называется RandomX, потому что, по сути, он вычисляет случайные значения. И теперь он вычисляет несколько иные, но всё же случайные значения.  
_**\<rbrunner>**_ А что, если майнеры Monero теперь помогают находить значения физических констант, необходимых для создания более совершенных атомных бомб? По-прежнему никаких проблем?  
_**\<matt>**_ Ну, даже если это и так, как бы ты заполучил такие значения от майнеров и собрал их?  
_**\<rbrunner>**_ Хмм. Кажется, ты прав. Но всё же странно. Пожертвование хоть стоило того?  
_**\<matt>**_ Можешь не сомневаться.  

---

Теперь я уже имел дело с двумя загадками: случайные сбои и формула. И я понятия не имел, были ли они как-то связаны, и если да, то как именно? Как бы то ни было, я начал копать.

Новая команда RandomX вычисляла последовательные члены, описанные указанной формулой, то есть что-то вроде бесконечных рядов в стиле 1/1 + 1/2 + 1/4 + 1/8 + 1/16 + .., но, конечно, более сложные и изощрённые. Откуда всё это взялось и что означало?

По счастливому совпадению незадолго до случившегося я прочитал историю о человеке из Индии по имени Шриниваса Рамануджан. В конце XIX и начале XX веков он заполнил несколько блокнотов выдающимися математическими формулами, которые, как выяснилось позднее, оказались верными. Таким образом, он открыл целые новые области в математике и вдохновил учёных на огромное количество дальнейших исследований. До сих пор неясно, как этот по большей части самоучка вывел все эти формулы и почему некоторые из них выглядели, как не из этого мира.

Я просмотрел некоторые из его работ на различных сайтах, и мне снова повезло: вскоре я нашёл «нашу» формулу. Она действительно принадлежала Шринивасе.

Но что делать дальше? Я решил, что мне нужен кто-то, кто мог бы рассказать больше об этом человеке и его открытиях. Погуглив, я наткнулся на сайт под названием mathemagicals.com, где упоминался этот человек и где были опубликованы некоторые совершенно дикие на первый взгляд вещи. Но я подумал, почему бы не поговорить с кем-то, может быть, немного сумасшедшим о двух столь же безумных проблемах, и договорился о видеозвонке с автором сайта, парнем по имени Курт.

Я спросил его, что потенциально можно получить, если члены такой формулы будут вычисляться снова и снова, не упоминая при этом Monero и не указывая, о какой именно формуле шла речь. Состоялся довольно интересный разговор.

---

«Вы когда-нибудь задавались вопросом, существуют ли цифры?» — спросил меня Курт.

«Что вы имеете в виду? Являются ли числа не только математическим изобретением человека, но и реально существуют где-то некоторым образом?»

Курт кивнул: «Да. У меня есть теория, согласно которой наша вселенная содержит ещё не открытое пятое измерение, математическое, где существуют числа, и они так же реальны, как материя в известных нам измерениях. Откуда же ещё взяться такому объёму математики во всём окружающем, например, во всех этих законах физики?»

Мне было чертовски любопытно, куда нас заведёт этот разговор: «И в этом дополнительном измерении число 3 живёт, скажем, в виде зелёного треугольника по соседству с числом 5, которое является синим».

«Что-то в этом роде, — улыбнулся Курт. — Я считаю, что целые числа существуют там почти в бесконечном количестве экземпляров. Не одно число 3, но целое множество. Почти как в случае с атомами или элементарными частицами. Они служат строительными блоками для более сложных вещей и даже существ».

«Существ?»

«Ну, да, в некотором роде сознательных существ. Я называю их числителями», — с гордостью заявил Курт.

Мне понадобилось полминуты или около того, чтобы переварить услышанное, прежде чем я смог продолжить: «Хорошо, интересная теория. Но как вы это докажете, как мы узнаем о существовании этих числителей? Думаете, мы сможем каким-либо образом поговорить с ними?»

«Кажется, иногда они разговаривают с нами. Возьмите, к примеру, Шринивасу. Знаете, что он сказал об источнике его поразительных математических прозрений?»

«Да, он утверждал, что богиня его семьи открыла их ему. Как там её звали?»

«Намагири Тайяр»

Я начал понимать: «Вы хотите сказать, что с ним говорил числитель из математического измерения?»

«Именно так. Один из тех, что особо хотят пообщаться с нами, — подтвердил Курт и продолжил. — Знаете, история, которую вы мне рассказывали о том, как снова и снова вычисляли одну из формул Шринивасы, звучит для меня так, как будто кто-то пытается привлечь внимание Намагири Тайяра, а затем установить контакт с этим существом».

«То есть, как если бы я пытался вызвать чей-то дух?»

Курт снова кивнул.

«Понимаю. Но с какой целью?»

Он продолжал уже взволнованно: «Вы хоть представляете, что это означает, говорить с настолько математическим, почти богоподобным существом? Сколько еще неизвестных и, следовательно, очень ценных истин, связанных с математикой, вы могли бы узнать?»

Это была интересная мысль, и я чуть не забыл задать важный вопрос: «А как насчёт тех компьютерных сбоев? Тут у вас тоже есть своя теория?»
Я терпеливо ждал, пока Курт обдумает поставленный вопрос. Наконец он сказал: «Ну... возможно, числитель пытается взаимодействовать с компьютерами, и это просто неудачный результат?»

---

Несколько дней спустя у меня состоялся ещё один разговор с Мэттом. Я решил пока на всякий случай не сообщать ему о своих выводах.

_**\<matt>**_ Наши проблемы с майнингом Monero скоро закончатся.  
_**\<rbrunner>**_ Правда? Как это вышло?  
_**\<matt>**_ Мы решили заменить эту загадочно проблематичную новую команду RandomX на ту, которая просто и невинно умножает на 3.  
_**\<rbrunner>**_ И в результате больше никаких сбоев?  
_**\<matt>**_ Никаких. И как бы мне ни хотелось узнать секрет, стоящий за всем этим, я также проголосовал за данное предложение. Мы должны восстановить порядок.  
_**\<rbrunner>**_ Так что, скоро состоится ещё один хардфорк, который позволит внести изменения?  
_**\<matt>**_ Да, и он будет реализован как можно скорее. Переход в тестовой сети состоится уже завтра.  

---

Завтра основная сеть Monero перейдёт на вновь изменённую версию RandomX и около миллиона компьютеров, разбросанных по всей планете, внезапно перестанут вычислять члены формулы Шринивасы. Если это и был какой-нибудь сигнал, то он внезапно исчез. И несмотря на то, что я чувствовал себя несколько глупо из-за всего этого, я всё же решил воспользоваться последней возможностью и самостоятельно попытаться проверить теорию Курта.

Я на полной скорости запустил на трёх своих домашних компьютерах модифицированный майнер RandomX, который теперь выполнял эту «магическую» команду 100% своего рабочего времени, не лишь со средней вероятностью 7/256, чтобы максимизировать шанс на получение сигнала, так сказать. Я отправился спать, пытаясь представить в уме формулу и думать о Шринивасе столько, сколько это было возможно, пока наконец не заснул.

И мне приснился сон.

Мне снились операции по модулю с большими числами, и, несмотря на то что я не особо был в теме, мне было абсолютно ясно, что я вижу криптографию на эллиптических кривых в действии. Чуть позже я увидел, как были вычислены члены формулы, которую я уже так хорошо знал. А потом, словно гром среди ясного неба, меня внезапно осенило:

Это было что-то, что известно в математике под названием «изоморфизм». Можно было бы взяться за задачу взлома криптографического шифра на основе эллиптических кривых, то есть до сих пор практически невозможную задачу получения приватных ключей на основе публичных, и как бы перевести её в другую математическую область, где необходимые вычисления были на много величин меньше и быстрее, что сделало бы решение такой задачи практически тривиальным.

И формула была связана с этой другой областью. Определённо, неизвестный человек, сделавший пожертвование для её включения в RandomX, уже подозревал об этом факте, но всё же по-прежнему отсутствовали некоторые важные части головоломки.

Воодушевившись перспективой узнать, как взломать криптографический шифр, а затем, несомненно, стать знаменитым или богатым, или и тем и другим, я так разволновался, что проснулся раньше, чем мой сон достиг последних критически важных подробностей.

А хардфорк должен был произойти уже всего через несколько часов.

Чёрт.

---

_**\<matt>**_ Ты уже слышал? Кажется, кто-то разгадал тайну сбоев.  
_**\<rbrunner>**_ Что-то я в этом сильно сомневаюсь, но рассказывай.  
_**\<matt>**_ Помнишь эксплойт Row Hammer, который появился несколько лет назад?  
_**\<rbrunner>**_ Что-то связанное с выбиванием битов памяти?  
_**\<matt>**_ Да. Оказалось, что с помощью тщательно подобранных шаблонов доступа к памяти можно так сильно напрячь современные чипы DRAM, что они время от времени будут осуществлять случайные перевороты битовых значений, и если повезет, то можно таким образом можно пробить брешь в защите памяти.  
_**\<rbrunner>**_ Прекрасно. И как это связано с неприятностями с RandomX?  
_**\<matt>**_ Кто-то узнал, что майнер, выполняющий нашу злополучную новую команду, вызывает данные из памяти таким образом, что это приводит к последствиям, схожим с теми, что наблюдались после использования Row Hammer.  
_**\<rbrunner>**_ Я бы сказал, что всё это звучит довольно неправдоподобно.  
_**\<matt>**_ Да, если честно, и я так и думал. Но всё же это лучше, чем другие теории, которые на полном серьёзе подразумевают вмешательство колдовских сил, lol.  
_**\<rbrunner>**_ Или других измерений.  
_**\<matt>**_ Что?  
_**\<rbrunner>**_ Ничего :)

---

_Источник: ["Numerator" - A Monero Fiction Short Story](https://rbrunner7.github.io/numerator.html)_

_Перевод: [Mr. Pickles](https://t.me/v1docq47)_  
_Коррекция: [Kukima](https://t.me/Kukima)_
