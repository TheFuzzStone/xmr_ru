---
title: "CT-016: Использование 1vyrain для «мягкого отключения» Intel ME на xx30 ThinkPads"
date: "2023-04-11"
categories:
  - "Статьи"
  - "Cypherpunk Transmission"
tags:
  - "Cypherpunk Transmission"
thumbnail: "img/copyright/cypherpunk-transmission/ct-016.png"
lead: "Это шестнадцатый отчёт из новой серии 'Cypherpunk Transmission'"
pager: true
toc: true
sidebar: "right"
---

## _Мотивация_

Как утверждают специалисты Intel, их подсистема Management Engine (ME) была разработана для того, чтобы удалённо управлять компьютерами на предприятиях с помощью технологии Active Management Technology (AMT). Эта компьютерная подсистема, состоящая в основном из проприетарной прошивки и потребляющая минимум энергии, встраивается практически во все чипсеты Intel, начиная с 2008 года.

Intel ME известна своей уязвимостью с точки зрения безопасности, и большинство пользователей, заботящихся о собственной приватности, считают её бэкдором.

И хотя полностью удалить эту подсистему невозможно, её всё же можно отключить. В этом руководстве показано, как с помощью 1vyrain1 можно программно отключить Intel ME на компьютерах ThinkPad xx30 без какого-либо специального оборудования.

## _Предварительные условия_

- Ваша система должна поддерживаться (любая серия xx30: X230/X230t/X330/T430/T430s/T530/W530).
- Наличие одного USB-накопителя.
- Ваш компьютер должен быть постоянно подключён к сети питания (при подключённой рабочей батарее).
- Наличие доступа к 64-битной системе Windows (чтобы при необходимости понизить версию BIOS с помощью IVprep).
- Базовый опыт работы с консолью.
- От 15 до 30 минут свободного времени.
- Вы должны ознакомиться и понять все предупреждения, которые приводятся ниже.
- Наличие достаточной решимости, чтобы попробовать выполнить эту рискованную операцию.

## 0. _ВНИМАНИЕ!_

Обычно такого рода текст приводится в разделе «Примечания» в конце статьи. Но это специальный выпуск.

Прежде чем приступить к работе с данным руководством, пожалуйста, очень внимательно прочитайте этот раздел, возможно, даже несколько раз.

### 0.1 _Хорошие новости_

Несмотря на то, что данный метод не позволяет полностью и окончательно заблокировать устройство, после всего вам потребуется программист для прошивки резервной копии или обновления BIOS.

### 0.2 _Плохие новости_

Отключение питания во время прошивки равносильно 100% гарантированной блокировке.

Перед прошивкой убедитесь на все 100%, что вы знаете пароль к вашей машине, даже если вы его удалили. Если вы не уверены, попробуйте очистить, включить и отключить пароль супервайзера/BIOS.

Установка оперативной памяти на частоту 1066 МГц означает блокировку.

Мы не даём никаких гарантий. Вы — единственный, кто несёт ответственность за поломку вашего устройства.

## 1. _Проверка совместимости с BIOS_

Перезагрузите ваш компьютер и, нажав соответствующую клавишу, войдите в настройки BIOS. [Узнайте](https://github.com/gch1p/thinkpad-bios-software-flashing-guide#bios-versions), имеет ли ваш ThinkPad ту версию BIOS, которая достаточно уязвима для взлома с помощью 1vyrain.

_Пример: На машинах X230 должен быть установлен BIOS версии 2.60 или ниже_.


| Модель        | Версия BIOS |
| --------------|-------------|
| X230          | 2.60        |
| X230t         | 2.58        |
| T430          | 2.64        |
| T430s         | 2.59        |
| T530          | 2.60        |
| W530          | 2.58        |

Если на вашей машине установлена более новая версия BIOS, вам придётся понизить её до совместимой с помощью [IVprep](https://github.com/n4ru/IVprep) (шаг 2).

Если версия BIOS достаточно стара, можно сразу перейти к шагу 3.

## 2. _Понижение версии BIOS с помощью IVprep_

### 2.1 _Подготовка настроек BIOS_

Войдите в настройки BIOS и задайте следующие настройки:

- Security > UEFI Bios Update Options > Flash Bios Updating by End-Users: **Enabled**
- Security > UEFI Bios Update Options > Secure RollBack Prevention > **Disabled**

### 2.2 _Загрузка IVprep_

Во время выполнения этой программы убедитесь, что компьютер подключён к питанию. Если во время прошивки питание отключится, компьютер гарантированно заблокируется.

Войдите в 64-битную Windows, скачайте последнюю версию IVprep4 с GitHub, распакуйте архив и запустите downgrade.bat (только не от имени администратора).

В командной строке должно появиться сообщение, подобное этому:

`Press Enter to downgrade your ThinkPad to 1vyrain compatible BIOS version (Нажмите Enter, чтобы понизить ThinkPad до совместимой с 1vyrain версии BIOS)`

Чтобы продолжить, нажмите **Enter**. Если служба User Account Control спросит разрешения на внесение изменений на вашем устройстве для приложения, нажмите **Yes**.

Через 5 секунд ваша система должна перезагрузиться, и вы увидите следующее сообщение:

`Begin Flashing... (Начало прошивки…)`

В течение 30 секунд система будет издавать звуковой сигнал. Не паникуйте, это ожидаемое поведение.

Последнее сообщение должно быть следующим:

`Image flashing done (Прошивка образа завершена)`

Система снова автоматически перезагрузится.

Всё готово.

Зайдя в BIOS и проверив версию, убедитесь, что обновление прошло успешно.

Если всё действительно прошло успешно, теперь у вас имеется версия BIOS, совместимая с 1vyrain (как было указано при выполнении шага 1), и вы можете переходить к следующему шагу.

## 3. _Взлом BIOS с помощью 1vyrain_

### 3.1 _Загрузка 1vyrain_

Загрузите последнюю версию 1vyrain (в настоящее время это Revision [5](https://drive.google.com/open?id=1yusq98ja6NmI4G4txKVueFqY_ZEwaZvO)).

Проверьте, совпадают ли хеши:

```
md5sum 1vyrain.iso
```

Результат должен быть следующим: `dd30313a8665e870360920b00cec55c4`.

### 3.2 _Создание рабочего USB_

Нам нужно записать образ 1vyrain (260 MiB) на USB-накопитель.

#### 3.2.1 _При работе с Linux_

Перед подключением USB-накопителя воспользуйтесь командой lsblk, чтобы увидеть подключённые устройства.

Подключите USB-накопитель и снова введите lsblk. Вы легко определите, какой именно накопитель является вашим.

_Примечание: Дважды проверьте и убедитесь в том, что вы не удалили не то устройство_.

Запустите dd:

```
sudo dd if=path/to/1vyrain.iso of=/dev/sdX status=progress
```

_Примечание: Замените `path/to/1vyrain.iso` и `/dev/sdX` на соответствующие значения_.

#### 3.2.2 _При работе с Windows_

При работе с Windows вы можете использовать [Rufus](https://rufus.ie/) в режиме DD. Никакой специальной конфигурации при этом не требуется.

### 3.3 _Подготовка настроек BIOS_

Войдите в настройки BIOS и выполните следующие действия:

- Startup > UEFI/Legacy Boot > **UEFI only**
- Security > Secure Boot > **Off**

_Примечание: Убедитесь, что ваша машина настроена на загрузку с USB-накопителя (переместите его в начало списка)_.

### 3.4 _Взлом BIOS_

_Примечание: И вновь убедитесь в том, что ваш компьютер подключён к питанию. Если во время прошивки питание отключится, компьютер гарантированно заблокируется_.

Выполните загрузку с USB-накопителя и следуйте инструкциям, которые появятся на экране.

Вы должны увидеть следующее сообщение:

`Press Enter key to attempt BIOS exploit. Your Thinkpad will suspend as part of the process. Press the power button to wake it up!  (Нажмите Enter, чтобы взломать BIOS. Работа Thinkpad будет приостановлена. Нажмите кнопку питания, чтобы разбудить его!)`

Нажмите **Enter**.

Когда ваш компьютер зависнет, нажмите кнопку питания.

В ответ на запрос `Please enter a choice: (Выберите действие)` нажмите **1** и **Enter**.

Должно появиться следующее сообщение:

`Press Enter key to begin flashing your jailbroken BIOS! Do NOT let the ThinkPad shut off during the process, you will need a hardware programmer to fix it! (Нажмите клавишу Enter, чтобы начать прошивку взломанного BIOS! Не позволяйте ThinkPad выключаться во время процесса, так как вам понадобится программист, чтобы исправить ситуацию!)`

Скрестите пальцы и нажмите **Enter**.

Скорее всего, вам придётся подождать от 30 до 60 секунд (`в состоянии Erasing and writing flash chip... (Стирание и запись флеш-памяти микросхемы...)`).

Наконец вы увидите сообщение об успешном завершении:

`All done! Press enter key to restart your ThinkPad or CTRL+C to exit to shell. (Всё готово! Нажмите Enter для перезагрузки ThinkPad или CTRL+C для выхода в оболочку)`

Нажмите **Enter**.

Произойдёт несколько ошибок CRC и перезагрузок. Это нормально.

Когда появится запрос, нажмите соответствующую клавишу, чтобы войти в настройки BIOS. Надеюсь, вы увидите новую вкладку Advanced (Продвинутые настройки).

# 4. _Отключение Intel ME_

Наконец-то мы можем отключить Intel ME. Это делается следующим образом:

- Advanced > ME configuration > Intel(R) ME > set to **Disabled**

_Примечание: Вы можете получить сообщение Configuration changed. Restart the system  (Конфигурация была изменена. Перезагрузите систему). Это нормально, и ваша машина, вероятно, перезагрузится перед загрузкой операционной системы_.

---

## _Примечания_

- Машины X330 поддерживаются, но определяются как обычные машины X230 (в меню прошивки есть дополнительная опция для прошивки BIOS с патчем LVDS для машин, определяемых как X230).
- Отключение Intel ME может не соответствовать вашей модели угрозы (Intel считает отключение ME угрозой для безопасности, но злоумышленники также могут воспользоваться ME для удалённого взлома системы).
- Для IVprep можно (но не проверено и потенциально более рискованно) использовать Linux вместо Windows (если вы проявите достаточный интерес, возможно, я напишу новый CT по этой теме).
- Режим Soft Temporary Disable Mode означает, что BIOS просит (но не заставляет) Intel ME отключиться при следующей загрузке, и этот режим сохраняется между перезагрузками и [выключениями](https://github.com/gch1p/thinkpad-bios-software-flashing-guide#about-intel-me).
- 1vyrain имеет дополнительные функции изменения BIOS: поддержку завышения тактовой частоты процессора (процессоры 35xx, 37xx, 38xx, 39xx), удаление из белого списка для использования любого WLAN/WWAN адаптера, и расширенное меню (настройка скорости вращения кулера, TDP, и тому подобное).
- С помощью 1vyrain вы также можете прошивать пользовательские изображения, используемые в BIOS (черепа, головы).
- Опытные пользователи могут попытаться собрать 1vyrain на базе [исходного кода](https://medium.com/@n4ru/1vyrain-self-build-documentation-5059825b1fdb).
- Пользуйтесь дополнительными источниками информации и узнавайте больше: [FAQ](https://medium.com/@n4ru/1vyrain-an-xx30-thinkpad-jailbreak-fd4bb0bdb654) по 1vyrain, Отключение Intel ME 11 в [недокументируемом режиме](https://web.archive.org/web/20201201175708/http://blog.ptsecurity.com/2017/08/disabling-intel-me.html?m=1), [Внутренняя прошивка](https://doc.coreboot.org/mainboard/lenovo/ivb_internal_flashing.html) Ivy Bridge Lenovo ThinkPad, [me_cleaner](https://github.com/corna/me_cleaner/wiki/How-to-apply-me_cleaner), [видео](https://redirect.invidious.io/watch?v=UpQAyO_eRc4) coreboot(skulls) от tripcode!Q/7.

---

## _Обратная связь_

Если эта статья показалась вам полезной, заинтересовала вас, дайте мне знать, и я сделаю всё возможное, чтобы публиковать подобные отчёты [Cypherpunk Transmission](https://monero.observer/tag/CT/) каждый (второй?) понедельник.

Вопросы, правки и предложения приветствуются.

Благодарю gnuteardrops из [monero.graphics](https://monero.graphics/) за потрясающую графику xkcd. Работа и шрифт xkcd лицензированы в соответствии с [CC BY-NC 3.0](https://github.com/ipython/xkcd-font/blob/master/LICENSE).

---

_Источник: [CT-016: Using 1vyrain to 'soft disable' the dreaded Intel ME on xx30 ThinkPads](https://monero.observer/cypherpunk-transmission-016-1vyrain-soft-disable-intel-me-xx30-thinkpads/)_

_Перевод: [Mr. Pickles](https://t.me/v1docq47)_  
_Коррекция: [Kukima](https://t.me/Kukima)_
