---
title: "«И никого не стало» или «Переживут ли наши кошельки переход на Monero 2.0»"
date: "2022-01-26"
categories:
  - "Статьи"
tags:
  - ""
lead: "Если всё будет происходить так, как планируется, то, вероятно, году в 2023-2024 состоится хардфорк Monero с переходом к использованию протокола второго поколения под названием Seraphis, а также новой схемой адресации Jamtis. Эти изменения столь обширны, что мы вполне может называть получившуюся в результате криптовалюты Monero 2.0."
pager: true
toc: true
sidebar: "right"
---

## _Краткая версия_

Если всё будет происходить так, как планируется, то, вероятно, году в 2023-2024 состоится хардфорк Monero с переходом к использованию протокола второго поколения под названием Seraphis, а также новой схемой адресации Jamtis. Эти изменения столь обширны, что мы вполне можем называть получившуюся в результате криптовалюты Monero 2.0.

Чтобы новая криптовалюта поддерживалась в полной мере, понадобится внести широчайшие функциональные изменения / изменения в UI кошельков Monero всех типов (десктоп-кошельков, кошельков для смартфонов, сетевых кошельков).

Тем не менее, как мне видится, ещё большей проблемой для кошельков является то, что основное программное обеспечение Monero, вероятно, будет иметь совершенно иной программный интерфейс / API, чем тот, что необходим кошелькам для реализации их функций в прежней манере. И это в свою очередь потребует широкого рефакторинга кода кошельков, независимо от языка программирования, который будет использоваться, и операционной системы (OS), под которой они будут работать. Это сложно, дорого и может занять много времени.

Лично я вижу в этом большую опасность, по крайней мере, для некоторых важных и самых используемых кошельков Monero, которые могут оказаться неготовы к хардфорку, и, вероятно, мы даже потеряем такие кошельки, поскольку для их авторов внесение изменений станет слишком непосильной задачей, и им придётся прекратить поддержку своих приложений.

Я предлагаю отдельно заняться этой проблемой и предотвратить подобный неудачный результат, выработав для кошельков чёткий и задокументированный план перехода на Seraphis и Jamtis, и заняться этим не после хардфорка, который маячит на горизонте всего-то на расстоянии нескольких месяцев, а уже **прямо сейчас**.

Решение проблемы, вероятно, про большей части коснётся менеджмента проекта, так как будет крутиться вокруг технологии и программных интерфейсов.

## _История вопроса_

Ведётся активная работа по реализации того, что можно было бы назвать «протоколом второго поколения» Monero под названием Seraphis. Подробности по этому вопросу были опубликованы @UkoeHB на GitHub, и вы найдёте их по этой [ссылке](https://github.com/UkoeHB/Seraphis). Параллельно @tevador занимается разработкой новой схемы адресации и верхнего уровня кошельков, которая будет использоваться в рамках Seraphis и носит название Jamtis. Существующую на данный момент документацию и соответствующее обсуждение можно найти [здесь](https://gist.github.com/tevador/50160d160d24cfc6c52ae02eb3d17024).

Планируемые изменения, если сравнивать с текущей версией протокола и схемой адресации Monero, будут самыми обширными: благодаря увеличению размера кольца планируется повысить уровень приватности, в блокчейн будут записываться транзакции с совершенно различными структурами, планируется переход на иные форматы адресов (каждый кошелёк получит новый адрес), типы кошельков (то есть, вместо 2 типов кошельков, «полного» и «предназначенного только для просмотра», появится гораздо больше новых типов), новый формат мнемонической фразы (16 слов вместо 25), и многое другое. В последнем чате на IRC UkoeHB полушутя назвал происходящее Monero 2.0, что лично я нахожу точным определением и здесь использую этот термин, чтобы был понятен масштаб планируемых изменений.

Я считаю, что переход на Seraphis и Jamtis станет гигантским шагом для Monero, но в то же самое время их внедрение станет монументальным предприятием с любой точки зрения, то есть, не только технически сложным, но и вызовом в отношении управления проектом для команды разработчиков открытого программного обеспечения, которая столь же велика и разнообразна, как сама Monero.

Если мы продолжим двигаться по этому пути, я осмелюсь предположить, что хардфорк с переходом на Seraphis и Jamtis может произойти в 2023 или 2024.

## _API кошелька Monero_

Существует большой и сложный класс C++ под названием Wallet2, являющийся неотъемлемой частью основной кодовой базы Monero. Соответствующий файл заголовка можно найти [здесь](https://github.com/monero-project/monero/blob/master/src/wallet/wallet2.h).

Этот класс можно бы было назвать «центром вселенной», вокруг которого и всё вертится, поскольку с ним связано большинство «потребительских» кошельков. Внутренне типичные приложения используют методы, принадлежащие к этому классу, для управления кошельками Monero — либо напрямую, либо через некоторый тонкий уровень, такой как wallet.h, который используется GUI (исходник можно найти по этой [ссылке](https://github.com/monero-project/monero/blob/master/src/wallet/api/wallet.h)).

Если рассматривать этот класс в качестве API, используемым кошельком Monero, насколько мне известно, этот интерфейс оставался невероятно устойчивым с момента появления Monero в 2014 году. Безусловно, он разросся с введением multisig, RingCT, подадресов и прочих вещей, но, пожалуй, он никогда не «падал», что стало удачным фактом для кошельков Monero, поскольку они могли опираться на прочный фундамент в течение многих лет.

## _Проблема_

Во время проведения упомянутого выше IRC-чата, посвящённого кошелькам Seraphis и Jamtis, я внезапно пришёл к осознанию следующей проблемы: есть вероятность, что не найдётся разумного способа просто в очередной раз расширить wallet2.h как API, чтобы внедрить Seraphis и Jamtis. На данный момент внесение для этого функциональных изменений, кажется мне слишком сложной задачей, и, на мой скромный взгляд, этот класс прежде всего не достаточно хорошо проработан, чтобы использовать в качестве такого важного API, и у него слишком низкий уровень абстракции, что делает его уязвимым к любым значимым функциональным изменениям.

Как бы то ни было, несмотря на то, что файл заголовка по-прежнему может выглядеть вполне разумно, wallet2.cpp — это гигантский и запутанный объём кода C++ (более 14 000 строк, которые вы найдёте [здесь](https://github.com/monero-project/monero/blob/master/src/wallet/wallet2.cpp)), требующего рефакторинга уже в течение нескольких лет, но до сих пор разработчики Monero не осмеливались взяться за решение этой задачи из-за того количества работы, которой им приходится заниматься, а также из-за центральной роли, которую играет класс для всей вселенной Monero, о чём было сказано выше.

Некоторым образом добавление функций кошелька Seraphis и схемы управления адресами Jamtis в wallet2, вероятно, стало бы полным безумием с технической точки зрения, и UkoeHB (на мой взгляд, совершенно оправдано) уже заявил, что не намерен даже пытаться сделать это.

Если вы внимательно читали, то что я писал, возможно, вы уже увидели ту же проблему, что и я: если этот API «упадёт» и будет заменён чем-то новым, что в значительной мере изменит фундамент, большинство кошельков Monero, опирающихся на него, будут буквально лишены почвы под ногами. Это потребует внесения значительных и требующих времени изменений в их кодовую базу.

А это, в свою очередь приведёт к серьёзной проблеме в управлении проектом: как сделать так, чтобы авторы приложений начали достаточно рано и своевременно адаптировать их код к хардфорку с переходом на Seraphis и Jamtis?

Если мы не отнесёмся к складывающейся ситуации со всей серьёзностью, в день хардфорка в полной мере будет функционировать лишь CLI-кошелёк, а GUI будет лишь на пути к этому, и совершенно не ясно, после обновлений будут ли вообще работать такие мобильные кошельки, как Monerujo и Cake Wallet. Или же наоборот, мы могли бы отложить хардфорк на много месяцев, возможно, что и не раз, даже не смотря на полную готовность с точки зрения основного программного обеспечения.

## _Предложение_

Я предлагаю выработать для кошельков чёткий и задокументированный план перехода на Seraphis и Jamtis, и заняться этим по возможности быстро.

Как мог бы выглядеть такой план? В первом раунде мозгового штурма у меня возникла идея, которую, возможно, стоит обсудить после запуска соответствующего проекта.

Может, у нас получится определить новый API, в рамках рабочего процесса назовём его wallet3, который с одной стороны был бы достаточно абстрактным и гибким, чтобы подстроиться под Seraphis и Jamtis, но с другой стороны который можно было бы использовать с уже существующими на данный момент кошельками Monero. При таком сценарии первым вариантом реализации wallet3 мог бы стать разумно тонкий уровень поверх wallet2, где прежний класс точно так же выполнял практически всю «тяжёлую работу».

Преимущество такого подхода заключалось бы в том, что при наличии такого API, например, в конце 2022 года, авторы кошельков могли бы начать переход уже в 2023 г оду, а затем сразу перейти на Seraphis и Jamtis при совершении хардфорка. Окончательный переход на новые технологии стал бы относительно простым и помог бы избежать болезненных проблем, которые иначе возникнут с наступлением конечного срока.

Ещё одной мыслью стало непосредственное исключение любых прямых «двоичных» интерфейсов и полный переход на RPC. Уже ведь существует практически полнофункциональный RPC-интерфейс кошелька (соответствующий файл заголовка можно найти [здесь](https://github.com/monero-project/monero/blob/master/src/rpc/core_rpc_server_commands_defs.h)), и, как мне кажется, у этого интерфейса больше шансов расшириться до возможности внедрения Seraphis и Jamtis, чем у wallet2.h.

Однако, чего я пока не знаю, насколько будет сложно перевести мобильные кошельки на такой RPC-фундамент.

Здесь стоит отметить, что разработчик @woodser совсем недавно определил новый и чёткий API кошелька, уже реализовал его на C++, Java и JavaScript. Документацию по техническому решению можно найти по этой [ссылке](https://moneroecosystem.org/monero-java/monero-spec.pdf), а вариант реализации на C++ [здесь](https://moneroecosystem.org/monero-java/monero-spec.pdf). Конечно, этот вариант предназначен только для существующей технологии, но он мог бы послужить и хорошей отправной точкой для создания wallet3.

@UkoeHB в настоящее время работает над «доказательством концепции» для кошелька Seraphis. Насколько я понимаю, у него будет «свежая» структура и интерфейс, разработанные буквально с нуля специально для Seraphis. Может, стоит подождать публикации этой работы перед тем, как обсуждать что-то вроде wallet3, но весь проект перехода можно было бы  запустить и до этого в качестве попытки нахождения консенсуса по общей стратегии.

## _Что требуется для достижения успеха_

Чтобы успешно реализовать проект «перехода кошелька Monero» подобно тому, как это было описано мной, как мне кажется, требуются две критически важные вещи.

Необходимо наличие людей, готовых заняться им, и лучше, если это будут люди уже знакомые с архитектурой и структурой кодовой базы Monero, а в идеале, обладающие опытом в разработке API и управлением проекта, построенного поверх него.

Но во-вторых сообщество разработчиков Monero и более широкая экосистема Monero должны стать на защиту выработанной стратегии и поддержать её в том виде, в котором она будет согласована. Авторы кошельков должны доверять стратегии перехода и API настолько, чтобы положить ее в основу будущего своих приложений, по крайней мере, на базе «слабого консенсуса», который тем не менее будет прочным и соответствующим.

Независимо от качества, довольно просто игнорировать до смерти что-то подобное этому и обращать всё в поражение. Постройте это, и никто не придёт по самым разным причинам, люди скажут: «Меня это не очень-то и заботит», или «Никто меня не просил об этом», «Это было изобретено не здесь», «Я мог бы сделать и лучше», или даже «Мне не нравятся люди из этой рабочей группы».

Безусловно, мне прекрасно известно, что принуждение в данном случае бесполезно; принятие должно прийти естественным путём как результат качественной работы и доверия, заработанного вовлечёнными в работу разработчиками.

---

_Источник: ["No Wallet Left Behind" - Make Sure Our Wallets Survive the Fork to Monero "NG"](https://www.reddit.com/r/Monero/comments/sczdrk/no_wallet_left_behind_make_sure_our_wallets/)_

_Перевод: [Mr. Pickles](https://t.me/v1docq47)_  
_Коррекция: [Kukima](https://t.me/Kukima)_
